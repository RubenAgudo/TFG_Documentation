\chapter{Desarrollo}
%Explicacion del trabajo desarrollado usando un lenguaje natural
%se debe dar respuesta a cuestiones como ¿Que se ha hecho? Tambien se explicara
%que problemas se han encontrado durante el desarrollo del trabajo, que soluciones 
%se han estudiado, cual fue la elegida etc. Todo ello justificando las decisiones tomadas

\section{Qu\'{e} se ha hecho}
Se ha desarrollado una aplicaci\'{o}n que dados unos datos organizados
de una determinada manera permite la visualizaci\'{o}n de los mismos y
la selecci\'{o}n de unos rangos para guardar y determinar que en ese rango de tiempo
est\'{a} sucediendo una acci\'{o}n determinada.

Los datos representan Pasos y Observaciones. Cada paso y observaci\'{o}n tiene una serie
de propiedades que son las que se visualizan. Estos datos, cuando fueron capturados, puede
que tengan uno o varios v\'{i}deos asociados. La visualizaci\'{o}n de los v\'{i}deos es completamente
optativa, y en caso de visualizarlos, ir\'{a}n sincronizados con los gr\'{a}ficos.

Es decir, en cada gr\'{a}fico habr\'{a} una l\'{i}nea de progreso para que sea f\'{a}cil determinar en que momento
de simulaci\'{o}n estamos \footnote{Un momento de simulaci\'{o}n es la unidad de tiempo elegida para la captura de datos, no
    necesariamente es un segundo.}.

\section{Decisiones importantes tomadas}
La elecci\'{o}n de la plataforma y entorno de desarrollo ven\'{i}a dada, por lo que las elecciones han sido tomadas
tomando como base que iba a usarse como Sistema Operativo, Windows 8.1 y Visual Studio 2013 como IDE.

\subsection{¿WPF o Windows Forms?}
Ambas tecnolog\'{i}as pertenecen a Microsoft, pero tienen diferencias clave. Entre otras cosas, WPF tuvo su lanzamiento inicial en 2006
junto con .NET Framework 3 \cite{WPF:Overview}. En cambio Windows Forms es una tecnolog\'{i}a 
mucho mas madura, que tiene a sus espaldas 12 años de desarrollo, y que fue lanzada junto con la primera versi\'{o}n de .NET Framework.

\subsubsection{Comparativa}
Lo mejor para realizar la comparativa es mediante una tabla, ya que se ven las capacidades de cada tecnolog\'{i}a.
La tabla ha sido confeccionada a partir de los datos obtenidos de \cite{WPFvsWinForms:Comparative} y elaboraci\'{o}n propia.

\begin{table}[H]
    \begin{center}
        \rowcolors{1}{lightgray}{} %\rowcolors{<starting row index>}{<odd row color>}{<even row color>}
        \begin{tabular}{|p{5cm} | p{4cm} | p{4cm}|}
            \rowcolor{darkgray}                         & \color{white}Windows Forms               & \color{white}WPF \\
            Formularios y controles                     & Si                                       & Si \\
            Documentos en pantalla                      & Si                                       & Si \\
            Documentos de formato fijo (XPS, PDF)       & No                                       & Si \\
            Im\'{a}genes                                & No                                       & Si \\
            V\'{i}deo y audio                           & No                                       & Si \\
            Gr\'{a}ficos 2D                             & No                                       & Si \\
            Gr\'{a}ficos 3D                             & No                                       & Si \\
            Interfaz compatible con altas resoluciones  & No, basada en BMP                        & Si, basada en vectores \\
            Creaci\'{o}n de la interfaz                 & Arrastrando y soltando los elementos     & Interfaz declarativa tipo XML \\
            Multilenguaje                               & Mediante archivos de recursos, f\'{a}cil y bien documentado & Mediante DLLs sat\'{e}lite, poco documentado y las herramientas aun no est\'{a}n listas para un entorno de producci\'{o}n. \\
            \hline
        \end{tabular}
    \end{center}
    \caption[Comparativa]{Comparativa Windows Forms, y WPF}
    \label{ComparativaWPF}
\end{table}

Como la mayor\'{i}a de las cosas que necesitaba para el proyecto WPF las cumpl\'{i}a sin a\~{n}adidos extra como GDI+ me decant\'{e} por
WPF.

\subsection{Sistema de gr\'{a}ficos}
A la hora de elegir de que manera iba a tratar los gr\'{a}ficos establec\'{i} una serie de caracter\'{i}sticas
que se deb\'{i}an satisfacer para elegir la librar\'{i}a.

Las condiciones son:
\begin{itemize}
    \item Permitir mostrar gr\'{a}ficos cont\'{i}nuos y discretos, y estos \'{u}ltimos tanto num\'{e}ricos como por categor\'{i}as.
    \item Permitir la selecci\'{o}n de rangos con el rat\'{o}n.
    \item Permitir mostrar el progreso del v\'{i}deo asociado. Bien sin programar la funci\'{o}n o al menos que fuese f\'{a}cilmente programable.
\end{itemize}

\subsubsection{Gr\'{a}ficos integrados de WPF}
Al principio parec\'{i}a una alternativa interesante, ya que no habr\'{i}a que depender de librer\'{i}as externas. Pero resulta
que son unos gr\'{a}ficos muy sencillos, con apenas opciones y que b\'{a}sicamente son unas polilineas sobre un elemento canvas.

Para conseguir satisfacer las condiciones requeridas para ser elegido requerir\'{i}a de un trabajo importante construyendo por mi mismo
las funciones requeridas, ya que de serie no cumple mas que el primer punto, adem\'{a}s sin mostrar datos sobre las leyendas ni permitiendo superponer
varias series de datos etc.

\paragraph{Ventajas:} Integrado en WPF, las funciones de serie son muy f\'{a}ciles de usar, documentaci\'{o}n abundante en MSDN.
\paragraph{Desventajas:} De serie no permite la selecci\'{o}n de rangos ni leyendas, ni mostrar el progreso asociado a un v\'{i}deo.
\paragraph{Veredicto:} Rechazado. 

\subsubsection{AForge .NET}
Framework ampliamente recomendada y usada para el tratamiento de im\'{a}genes, gr\'{a}ficos, Computer Vision, inteligencia artificial, machine learning etc.

De serie soporta mostrar los gr\'{a}ficos continuos y discretos y la selecci\'{o}n de rangos. Al permitir la selecci\'{o}n de rangos
intuyo que programar la sincronizaci\'{o}n con el v\'{i}deo es bastante f\'{a}cil.

\paragraph{Ventajas:} Framework Open Source, cumple con todos los requisitos, documentaci\'{o}n abundante.
\paragraph{Desventajas:} Los controles para mostrar los gr\'{a}ficos son controles .NET, no WPF. La documentaci\'{o}n sobre mostrar los gr\'{a}ficos no
esta demasiado elaborada.
\paragraph{Veredicto:} Rechazado.

\subsubsection{WPF Toolkit}
Extensi\'{o}n open source de las capacidades de mostrar gr\'{a}ficos de WPF desarrollado por Microsoft de manera oficial. 
Ofrece una manera muy simple y muy clara depoder enlazar datos con un ViewModel o bien de manera program\'{a}tica. 
Admite la representaci\'{o}n de todo tipo de gr\'{a}ficos imaginables: Histrogramas, \'{a}rea, barras horizontales, 
l\'{i}nea, dispersi\'{o}n, circular (tarta), burbuja...
 
La presentaci\'{o}n de los gr\'{a}ficos es muy profesional, pero no he encontrado ninguna manera de poder seleccionar un rango sin tener que modificar
por mi mismo las clases del propio toolkit. Por lo que \'{u}nicamente cumple uno de los tres requisitos indispensables, y el \emph{workaround} no
es algo que se haga en un momento y no es algo sencillo de llevar a cabo.

\paragraph{Ventajas:} Open Source, mantenido por Microsoft, por lo que podemos asegurar una estabilidad alta, sencillez de uso, gr\'{a}ficos profesionales.
\paragraph{Desventajas:} Ausencia total de documentaci\'{o}n, el proyecto lleva sin actualizarse desde 2010, no permite de manera f\'{a}cil seleccionar 
rangos ni sincronizar con v\'{i}deo.
\paragraph{Veredicto:} Rechazado.

\subsubsection{OxyPlot}
Librer\'{i}a Open Source para crear gr\'{a}ficos de manera sencilla, y lleno de caracter\'{i}sticas interesantes. De serie permite f\'{a}cilmente
realizar las 3 necesidades b\'{a}sicas.

\paragraph{Ventajas:} Open Source, aplicaci\'{o}n con ejemplos para que sea mas sencillo crear los gr\'{a}ficos, permite la selecci\'{o}n de rangos
de manera sencilla, todo tipo de gr\'{a}ficos, controles para WindowsForms, WPF etc.
\paragraph{Desventajas:} Apenas hay documentaci\'{o}n, parece una librer\'{i}a bastante nueva por lo que se esperan \emph{bugs}. 
\paragraph{Veredicto:} Aceptado.

\section{Sistema de composici\'{o}n de ventanas}
Para el sistema de ventanas, interesaba que las ventanas se pudiesen reorganizar libremente. Crearse grupos de pesta\~{n}as, pesta\~{n}as flotantes, 
dividir la ventana en distintos trozos etc.
\subsection{AvalonDock}
AvalonDock es un control de ventanas del muelle para WPF que te permite crear dise\~{n}os personalizables mediante un sistema de anclaje de ventanas con todas
las características similares a lo que se encuentra en muchos entornos de desarrollo integrados populares IDE) como Visual Studio. 

\paragraph{Ventajas:} Proyecto Open Source, bastante maduro, estable y popular, por lo que encontrar recursos online es bastante sencillo.
\paragraph{Desventajas:} La documentaci\'{o}n oficial no es muy buena y no est\'{a} terminada para la versi\'{o}n 2 de AvalonDock.
\paragraph{Veredicto:} Aceptado.

\section{M\'{e}todo de guardado de datos}
Como toda aplicaci\'{o}n, hay que guardar datos en alg\'{u}n sitio para poder seguir trabajando otro d\'{i}a. La elecci\'{o}n evidente
suele ser elegir una base de datos relacional cl\'{a}sica. Pero en este caso concreto el software no va a ser integrado directamente dentro de una
suite mayor, sino que va a ser un programa aparte, que en un futuro podr\'{a} integrarse, por lo que usar una base de datos puede que tenga sentido,
o no, ve\'{a}moslo.
\subsection{MySQL / MariaDB}
El est\'{a}ndar de facto en cuanto a bases de datos relacionales se refiere, sobre todo para proyectos Open Source. Es el gestor de bases de 
datos relacionales mas usado del mundo.

\paragraph{Ventajas:} Open Source, ingente cantidad de documentaci\'{o}n, al ser muy popular encontrar recursos online, como ejemplos
es muy sencillo.

\paragraph{Desventajas:} Recientemente (MySQL) fue comprado por Oracle. Nuestros datos no son f\'{a}cilmente estructurables en tablas, lo
que resultar\'{i}a en muchas tablas y referencias para obtener unos datos muy sencillos.

\paragraph{Veredicto:} Rechazado.

\subsection{MongoDB}
Base de datos de nueva generaci\'{o}n conocida como NoSQL. Los datos se guardan en estructuras conocidas como ``documentos´´ y a su vez los
documentos se guardan en ``colecciones´´. Cada documento tiene un formato muy similar a JSON 
\footnote{especificaci\'{o}n JSON: \url{http://json.org/}}.

\paragraph{Ventajas:} Open Source, en los \'{u}ltimos tiempos se ha vuelto muy popular por lo que hay muchas referencias
online. Muy buen rendimiento cuando no hay que hacer relaciones, permite guardar y recuperar estructuras de datos muy complejas. Drivers
muy potentes para el desarrollo en C\#.

\paragraph{Desventajas:} Al no ser un est\'{a}ndar no sabemos si seguira existiendo de aqu\'{i} a diez a\~{n}os. Obligar\'{i}amos
al resto de software que vaya a interactual con el nuestro a utilizar la base de datos aunque \'{u}nicamente sea para leer los datos,
lo que a\~{n}ade una capa de complejidad que queremos evitar, y haciendo los datos mas ``oscuros´´ y ocultos.

\paragraph{Veredicto:} Rechazado.

\subsection{XML}
Est\'{a}ndar desarrollado por W3C que intenta ser un formato que sea f\'{a}cilmente legible por los humanos tanto como por las m\'{a}quinas. La
versi\'{o}n actual es 1.0 quinta edici\'{o}n. Es un formato recomendado por la W3C \cite{XML:Specification}.

\paragraph{Ventajas:} Formato est\'{a}ndar ampliamente utilizado, f\'{a}cil de leer y de crear tanto por humanos como por m\'{a}quinas, los
lenguajes modernos permiten cargar los XML f\'{a}cilmente y realizar consultas similares a SQL por lo que buscar, filtrar e iterar se hace muy sencillo.
Tambi\'{e}n muy f\'{a}cil compartir informaci\'{o}n entre aplicaciones si se define un esquema com\'{u}n y si es validado en ambos extremos los datos
siempre ser\'{a}n consistentes. No requiere de un software externo para funcionar.

\paragraph{Desventajas:} Propiamente dicho no es un formato pensado para aplicaciones de escritorio, sino para la web. No se puede acceder a los datos 
directamente como de una base de datos se tratase, ya que el fichero tiene que se proporcionado para su uso.
\paragraph{Veredicto:} Aceptado.

\section{Estructura de los XML de guardado y cargado de datos}
Despu\'{e}s de elegir como \'{i}bamos a guardar los datos, llegamos a la tesitura de elegir una estructura de guardado. las dos opciones son las
siguientes. 
\subsection{Estructura 1}
\lstinputlisting[tabsize=2, language=XML, numbers=left]{./Attachments/Adjunto1.xml}

Como se puede observar, el acercamiento sugerido es, que por cada instante de simulaci\'{o}n guardemos las observaciones que est\'{a}n teniendo lugar,
y los valores de las propiedades que tienen en ese instante.

Este formato, a la vista parece bueno, ya que podr\'{i}amos construir los gr\'{a}ficos instante a instante, todos a la vez. Pero, ¿Y si queremos
obtener el valor de una propiedad en concreto para mostrar todo el gr\'{a}fico de golpe? No se obtiene de manera directa, ya que habr\'{i}a que ciclar
a trav\'{e}s de todos los nodos instante, y a trav\'{e}s de todos los nodos observaci\'{o}n, buscando la propiedad que nos interesa. 

N\'{o}tese que en distintas observaciones puede haber propiedades que tengan el mismo nombre, aumentando de complejidad la b\'{u}squeda.

\subsection{Estructura 2}
\lstinputlisting[tabsize=2, language=xml, numbers=left]{./Attachments/Adjunto2.xml}

En este segundo ejemplo, de un simple vistazo podemos determinar todos los valores que va a tomar una propiedad de una observaci\'{o}n en concreto,
sin ning\'{u}n tipo de iteraci\'{o}n. En el nodo \emph{<data>} se ha a\~{n}adido un nuevo atributo \emph{instantLength} que determina, en segundos,
la longitud de un instante. 

Por ejemplo, en la propiedad \emph{prop14} se ve que los instantes no son consecutivos, por lo que el sistema sabe que el gr\'{a}fico ha de ser
disjunto en ese punto, es decir, desde el punto (1, 4) no debe unirse al (3, 5). Esto es \'{u}til para saber si una propiedad esta sucediendo o no.

\section{Gesti\'{o}n del c\'{o}digo fuente}
Todo proyecto debe llevar una gesti\'{o}n eficiente de su c\'{o}digo fuente de una u otra manera. Las opciones que se barajaron fueron las siguientes,
teniendo en cuenta que deb\'{i}a permitir volver a versiones anteriores f\'{a}cilmente y poder trabajar sobre una copia, y sincronizar con los
distintos dispositivos de desarrollo que utilizo habitualmente.

\subsection{Dropbox}
Un viejo conocido desde principios de la carrera. Un servicio de sincronizaci\'{o}n de carpetas, que ofrece un ``pendrive´´ en la nube de 2GB ampliable.

\paragraph{Ventajas:} La sincronizaci\'{o}n entre dispositivos es perfecta, realiz\'{a}ndose al instante, multiplataforma, y gratuito, pero de c\'{o}digo
cerrado, mantiene un hist\'{o}rico de cambios de los archivos. Sencill\'{i}simo de utilizar, apenas requiere de configuraci\'{o}n o conocimientos
t\'{e}cnicos.

\paragraph{Desventajas:} Para trabajar sobre una copia, hay que realizar una copia f\'{i}sica de todo el proyecto, algo que no suele ser pr\'{a}ctico.
Todos los cambios que se realicen se confirman al instante en todos los dispositivos, pudiendo romper algo que funcionaba bien. Dif\'{i}cil de manejar
el hist\'{o}rico de versiones, ya que crea una copia cada vez que sincroniza un cambio.

\paragraph{Veredicto:} Rechazado.

\subsection{GIT}
Software de control de versiones distribuido, dise\~{n}ado espec\'{i}ficamente para esa tarea por Linus Torvalds y contribuyentes. Aunque esta dise\~{n}ado 
para que un equipo pueda trabajar de manera mas eficiente y con pocos conflictos, es muy \'{u}til para proyectos unipersonales, ya que no vas a tener que
resolver conflictos porque todo ha sido desarrollado por ti, y tienes todas las ventajas de un software de control de versiones.

\paragraph{Ventajas:} Permite la creaci\'{o}n de versiones (bifurcaciones) del c\'{o}digo actual, manteniendo 2 versiones paralelas. Permite volver a 
cualquier instante de desarrollo del proyecto que se hubiera confirmado previamente. Fusionar dos ramas de desarrollo etc. Para mas informaci\'{o}n ver la 
secci\'{o}n de herramientas utilizadas.

\paragraph{Desventajas:} Curva de aprendizaje pronunciada. Pese a que hay disponibles muchas interfaces gr\'{a}ficas, para sacarle todo el provecho hay
que utilizar la consola. Requiere de una configuraci\'{o}n inicial que depende de la experiencia puede ser mas o menos compleja.

\paragraph{Veredicto:} Aceptado.

\section{Creaci\'{o}n de la documentaci\'{o}n}
Aunque esta secci\'{o}n pueda parecer una elecci\'{o}n obvia, me trajo bastantes quebraderos de cabeza. Por un lado quer\'{i}a algo que no requiriera
de un estudio previo de 3 meses, que fuese lo suficientemente potente, que su rendimiento no decreciera seg\'{u}n aumentaban las p\'{a}ginas, y desde luego,
que pudiera editar tanto desde Windows, como Linux.
\subsection{Microsoft Office}
C\'{o}mo el proyecto lo estaba realizando en Windows, y para Windows, parec\'{i}a la elecci\'{o}n obvia. Un producto potente muy bien integrado
en Windows, que permite crear documentos muy vistosos de manera muy sencilla. Pese a solo tener versiones oficiales de Windows y Mac OSX en Linux
funciona razonablemente bien utilizando WINE.

\paragraph{Ventajas:} Muy f\'{a}cil de usar y utilizado en numerosas ocasiones a lo largo de la carrera. Sigue un esquema WYSIWYG (Lo que ves, es lo
que obtienes), por lo que el dise\~{n}o se hace muy sencillo. Exporta a PDF directamente.

\paragraph{Desventajas:} De pago, seg\'{u}n aumenta el n\'{u}mero de p\'{a}ginas el rendimiento desciende, sobre todo si tiene im\'{a}genes o tablas
grandes. El tama\~{n}o de los ficheros resultantes, si tiene im\'{a}genes es bastante grande. A veces la colocaci\'{o}n de las tablas y las im\'{a}genes
puede ser intrincado.

\paragraph{Veredicto:} Rechazado.


\subsection{LibreOffice / OpenOffice}
B\'{a}sicamente tuve en cuenta a LibreOffice y OpenOffice porque son multiplataforma, pero adolecen de los mismos problemas que Microsoft Office.
El manejo de tablas e im\'{a}genes es aun mas complicado, y no se consiguen resultados visualmente tan agradables.

Se que todo lo que se hace en Microsoft Word puede hacerse en LibreOffice, pero requerir\'{i}a de dedicarle bastante tiempo a estudiar como hace
LibreOffice las cosas. Como ventaja a\~{n}adida tiene que es una suite ofim\'{a}tica gratuita y de c\'{o}digo abierto.

\paragraph{Veredicto:} Rechazado.

\subsection{\LaTeX}
Software de composici\'{o}n de textos creado por Donald E. Knuth \footnote{\url{http://www-cs-faculty.stanford.edu/~uno/}} muy popular entre los
cient\'{i}ficos. Ofrece una manera similar de crear documentos a HTML aunque deber\'{i}a decirse al rev\'{e}s, ya que \LaTeX es bastante mas antiguo.

Para sacarle todo el partido se requiere un buen editor, con resaltado de sintaxis y autocompletado, mi elecci\'{o}n ha sido TexStudio, un
software de c\'{o}digo abierto que ofrece todo tipo de facilidades, multiplataforma.

\paragraph{Ventajas:} Independientemente de lo largo o complejo que sea el texto, el archivo que lo contiene es un fichero en texto plano, por lo que
puede ser editado pr\'{a}cticamente con cualquier editor de textos. Independientemente del software que se use para su creaci\'{o}n, una vez compilado
en todos los sitios se ver\'{a} igual. Abstrae al escritor de la forma para que se centre en el contenido, el estilo se define una vez, al inicio del
escrito, y se mantiene consistente a lo largo de todo el documento. Proyecto Open Source y mucha documentaci\'{o}n online. Miles de paquetes y 
macros que extienden la funcionalidad inicial, por ejemplo para mostrar c\'{o}digo de manera limpia, estilos etc. 

\paragraph{Desventajas:} Requiere de un aprendizaje previo, as\'{i} como la necesidad de instalar un software externo que compile lo que hemos escrito,
conocido como \emph{Distribuciones \LaTeX}. Al ser tan extensible cada paquete dispone de su propia documentaci\'{o}n por lo que puede ser mas improductivo
al principio. 

\paragraph{Veredicto:} Aceptado.
